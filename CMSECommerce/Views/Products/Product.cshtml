@model Product

@{
    ViewData["Title"] = Model.Name;

    var allImages = new List<string>();

    if (!string.IsNullOrEmpty(Model.Image))
    {
        allImages.Add($"/media/products/{Model.Image}");
    }

    if (Model.GalleryImages?.Any() == true)
    {
        foreach (var img in Model.GalleryImages)
        {
            allImages.Add($"/media/gallery/{Model.Id}/{img}");
        }
    }

    var defaultImagePath = "/media/default-product.png";

    if (!allImages.Any())
        allImages.Add(defaultImagePath);

    bool isInStock = Model.StockQuantity > 0;
}

<div class="container py-4">

    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb bg-light rounded p-2">
            <li class="breadcrumb-item">
                <a asp-controller="Home" asp-action="Index" class="text-decoration-none">Home</a>
            </li>
            <li class="breadcrumb-item">
                <a href="/products" class="text-decoration-none">Products</a>
            </li>
            <li class="breadcrumb-item active fw-bold" aria-current="page">@Model.Name</li>
        </ol>
    </nav>

    <div class="row">

        <!-- LEFT COLUMN — Images -->
        <div class="col-lg-6 mb-4">

            <div class="border rounded p-3 shadow-sm bg-white text-center">
                <img id="mainImage"
                     src="@allImages.First()"
                     class="img-fluid"
                     style="max-height:480px; object-fit:contain;" />
            </div>

            @if (allImages.Count > 1)
            {
                <div class="row g-2 mt-3">
                    @foreach (var img in allImages)
                    {
                        <div class="col-3 col-sm-2">
                            <img src="@img"
                                 class="img-fluid rounded border thumb-img"
                                 data-img="@img"
                                 style="height:60px; object-fit:cover; cursor:pointer;" />
                        </div>
                    }
                </div>
            }
        </div>

        <!-- RIGHT COLUMN — Product Info -->
        <div class="col-lg-6">

            <h2 class="fw-bold mb-3">@Model.Name</h2>

            <!-- Stars -->
            <div class="text-warning mb-2">
                <i class="fas fa-star"></i><i class="fas fa-star"></i>
                <i class="fas fa-star"></i><i class="fas fa-star-half-alt"></i>
                <i class="far fa-star"></i>
                <span class="text-muted small ms-2">(128 ratings)</span>
            </div>

            <!-- Price -->
            <h1 class="text-primary fw-bolder mb-4">@Model.Price.ToString("C2")</h1>

            <!-- Add to Cart -->
            <form asp-controller="Cart" asp-action="Add" method="post">
                <input type="hidden" name="id" value="@Model.Id" />

                <div class="d-flex align-items-center mb-3">
                    <label class="fw-bold me-3">Qty:</label>

                    <input type="number"
                           name="quantity"
                           value="1"
                           min="1"
                           max="@Model.StockQuantity"
                           class="form-control text-center"
                           style="width:85px;"
                           @(isInStock ? "" : "disabled") />
                </div>

                @if (isInStock)
                {
                    <button type="submit" class="btn btn-primary btn-lg w-100 mb-3">
                        <i class="fas fa-cart-plus me-1"></i> Add to Cart
                    </button>

                    <a asp-controller="Cart" asp-action="Index"
                       class="btn btn-outline-success btn-lg w-100">
                        <i class="fas fa-shopping-cart me-1"></i> View Cart
                    </a>
                }
                else
                {
                    <button class="btn btn-danger btn-lg w-100" disabled>
                        Out of Stock
                    </button>
                }
            </form>

            <!-- Stock Info -->
            <p class="mt-3">
                @if (isInStock)
                {
                    <span class="text-success fw-bold">In Stock</span>
                    <span class="text-muted">(@Model.StockQuantity available)</span>
                }
                else
                {
                    <span class="text-danger fw-bold">Out of Stock</span>
                }
            </p>

            <ul class="list-unstyled small text-muted">
                <li><i class="fas fa-truck me-2 text-info"></i> Free Shipping over ₹1500</li>
                <li><i class="fas fa-shield-alt me-2 text-info"></i> Secure Checkout</li>
                <li><i class="fas fa-undo me-2 text-info"></i> 7-Day Return Policy</li>
            </ul>

        </div>
    </div>

    <hr class="my-5" />

    <!-- DESCRIPTION -->
    <h3 class="fw-bold mb-3">Product Description</h3>
    <div class="text-dark">
        @Html.Raw(Model.Description)
    </div>

</div>

@section Scripts {

    <!-- Thumbnail Click -->
    <script>
        document.querySelectorAll('.thumb-img').forEach(img => {
            img.addEventListener('click', function () {
                document.getElementById('mainImage').src = this.dataset.img;

                document.querySelectorAll('.thumb-img').forEach(t => {
                    t.style.border = '1px solid #ddd';
                });

                this.style.border = '2px solid #0d6efd';
            });
        });
    </script>

    <!-- CSS FIXES -->
    <style>
        @@media (max-width: 576px) {
            #mainImage {
                max-height: 300px !important;
            }

            .thumb-img {
                height: 50px !important;
            }
        }
    </style>
}
