@model CMSECommerce.Models.ViewModels.RegisterViewModel

@{
    ViewData["Title"] = "Create Account";
    ViewData["HideLayoutSidebar"] = true;
}

@section Styles {
    <link rel="stylesheet" href="~/css/register.css" />
    <style>
        /* Ensures the scroll detection is accurate */
        #TermsScrollBox {
            height: 300px;
            overflow-y: auto;
            padding-right: 10px;
            border: 1px solid #eee;
            padding: 15px;
            border-radius: 4px;
        }

        .terms-accepted {
            border: 1px solid var(--amazon-orange) !important;
            background-color: #fffaf3;
        }
    </style>
}

<div class="amazon-login-page py-5">
    <div class="container d-flex justify-content-center">
        <div style="width: 100%; max-width: 350px;">
            <div class="text-center mb-3">
                <h2 class="fw-bold" style="letter-spacing: -1px;">
                    Wey<span style="color:var(--amazon-orange)">paari</span>
                </h2>
            </div>

            <div class="amazon-form-box p-4 bg-white">
                <h1 id="formHeader" class="h3 fw-normal mb-3 text-amazon-dark">Create account</h1>

                <form asp-action="Register" method="post" id="registrationForm" novalidate autocomplete="off">
                    @Html.AntiForgeryToken()
                    <div asp-validation-summary="ModelOnly" class="alert alert-danger small p-2" role="alert"></div>

                    @* Identifier *@
                    <div class="form-group mb-3">
                        <label asp-for="Username" class="form-label fw-bold label-small text-amazon-dark mb-1">Email, Mobile, or ITS Number</label>
                        <input asp-for="Username" id="UserInput" class="form-control amazon-input-field" placeholder="Email, Mobile, or 8-digit ITS" autocomplete="off" />
                        <span asp-validation-for="Username" id="UserError" class="text-danger small mt-1 d-block"></span>
                    </div>

                    <div id="registrationFields">
                        <div class="form-group mb-3" id="BackupEmailContainer">
                            <label asp-for="Email" class="form-label fw-bold label-small text-amazon-dark mb-1">Email</label>
                            <input asp-for="Email" id="EmailInput" class="form-control amazon-input-field" type="email" autocomplete="off" />
                            <span asp-validation-for="Email" id="EmailError" class="text-danger small mt-1 d-block"></span>
                        </div>

                        <div class="form-group mb-3" id="BackupMobileContainer">
                            <label asp-for="PhoneNumber" class="form-label fw-bold label-small text-amazon-dark mb-1">Mobile number</label>
                            <input asp-for="PhoneNumber" id="PhoneInput" class="form-control amazon-input-field" placeholder="10-digit mobile" maxlength="10" inputmode="numeric" autocomplete="off" />
                            <span asp-validation-for="PhoneNumber" id="PhoneError" class="text-danger small mt-1 d-block"></span>
                        </div>
                    </div>

                    <div class="form-group mb-2">
                        <label asp-for="Password" class="form-label fw-bold label-small text-amazon-dark mb-1">Password</label>
                        <input asp-for="Password" id="PassInput" type="password" class="form-control amazon-input-field" placeholder="At least 6 characters" autocomplete="new-password" />
                        <span asp-validation-for="Password" id="PassError" class="text-danger small mt-1 d-block"></span>
                        <div id="passwordHint" class="info-box mt-1">
                            <i class="fas fa-info text-info me-1"></i> Passwords must be at least 6 characters.
                        </div>
                    </div>

                    <div id="confirmPasswordGroup" class="form-group mb-3">
                        <label asp-for="ConfirmPassword" class="form-label fw-bold label-small text-amazon-dark mb-1">Re-enter password</label>
                        <input asp-for="ConfirmPassword" id="ConfirmPassInput" type="password" class="form-control amazon-input-field" autocomplete="new-password" />
                        <span asp-validation-for="ConfirmPassword" id="ConfirmPassError" class="text-danger small mt-1 d-block"></span>
                    </div>

                    @* THE FIX: Updated Terms Agreement Section *@
                    <div id="TermsSection" class="form-group mb-3 p-2 rounded border border-transparent">
                        @* Hidden input that maps to the C# Model *@
                        <input type="hidden" asp-for="HasAcceptedTerms" id="TermsCheckbox" value="false" />

                        <div class="amazon-checkbox-wrapper d-flex align-items-start">
                            @* Visual only checkbox - not bound to Model *@
                            <input type="checkbox" id="VisualCheckbox" class="form-check-input me-2" disabled />
                            <label class="info-box text-amazon-dark small">
                                I agree to Weypaari's <a href="javascript:void(0)" id="OpenTerms" class="text-amazon-link fw-bold">Conditions of Use</a>.
                            </label>
                        </div>
                        @* Use a standard span for the error to avoid library hijacking *@
                        <span id="TermsError" class="text-danger small d-block mt-1"></span>
                    </div>

                    <div class="d-grid mt-3 mb-3">
                        <button type="submit" id="submitBtn" class="btn btn-amazon-checkout w-100">Continue</button>
                    </div>

                    <p id="legalNotice" class="info-box mb-4">
                        By creating an account, you agree to Weypaari's <a href="javascript:void(0)" id="OpenTermsLegal" class="text-amazon-link">Conditions of Use</a> and <a href="javascript:void(0)" onclick="openPrivacyPopup()" class="text-amazon-link">Privacy Notice</a>.
                    </p>

                    <hr />
                    <div id="footerLink" class="text-start info-box">
                        Already have an account? <a asp-action="Login" class="text-amazon-link">Sign in <i class="fas fa-caret-right" style="font-size:10px"></i></a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@* Modal HTML *@
<div class="modal fade" id="termsModal" data-bs-backdrop="static" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow">
            <div class="modal-header bg-light">
                <h5 class="modal-title fw-bold">Weypaari Conditions of Use</h5>
            </div>
            <div class="modal-body">
                <div id="TermsScrollBox">
                    <p class="small text-muted">Last Updated: January 2026</p>

                    <h6>1. Acceptance of Terms</h6>
                    <p>By accessing or using the Weypaari platform, you agree to be bound by these Conditions of Use. If you do not agree to these terms, please do not register for an account.</p>

                    <h6>2. Eligibility & Registration</h6>
                    <p>To use Weypaari, you must provide a valid 8-digit ITS number, Email, or Mobile number. You agree to provide accurate, current, and complete information during the registration process. Weypaari reserves the right to suspend accounts that provide false data.</p>

                    <h6>3. Privacy & Data Security</h6>
                    <p>Your privacy is important to us. Information provided during registration is used solely for identity verification and platform functionality. We do not sell your personal data to third parties. You are responsible for maintaining the confidentiality of your account password.</p>

                    <h6>4. User Conduct</h6>
                    <p>Users shall not engage in any activity that interferes with or disrupts Weypaari services. Prohibited actions include, but are not limited to, fraudulent transactions, posting offensive content, or attempting to bypass security protocols.</p>

                    <h6>5. Transactions & Listings</h6>
                    <p>Weypaari provides a marketplace platform. While we facilitate community commerce, Weypaari is not a party to the actual transactions between buyers and sellers and is not responsible for the quality, safety, or legality of the items advertised.</p>

                    <h6>6. Termination of Use</h6>
                    <p>We reserve the right to terminate or suspend your access to Weypaari at our sole discretion, without notice, for conduct that we believe violates these Terms or is harmful to other users of the community.</p>

                    <h6>7. Modifications to Service</h6>
                    <p>Weypaari reserves the right to modify or discontinue, temporarily or permanently, the service with or without notice at any time.</p>

                    <div style="height: 50px;"></div>
                    <p class="text-center text-muted small"><em>You have reached the end of the document.</em></p>
                </div>
            </div>
            <div class="modal-footer bg-light">
                <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cancel</button>
                <button type="button" id="ModalAgreeBtn" class="btn btn-amazon-checkout" disabled>I have read and agree</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        const validateUrl = '@Url.Action("ValidateIdentifier", "Account")';
        const loginUrl = '@Url.Action("Login", "Account")';
        const registerUrl = '@Url.Action("Register", "Account")';

        function openPrivacyPopup() {
            const w = 600, h = 700;
            const left = (screen.width/2)-(w/2), top = (screen.height/2)-(h/2);
            window.open('@Url.Action("Privacy", "Home")', 'PrivacyNotice', `width=${w},height=${h},top=${top},left=${left},scrollbars=yes`);
        }
    </script>
    <script src="~/js/register.js"></script>
}