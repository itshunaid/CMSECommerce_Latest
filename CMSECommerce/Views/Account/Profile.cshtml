@model CMSECommerce.Models.ViewModels.ProfileUpdateViewModel

@{
    ViewData["Title"] = "Update Profile";
}

@section Styles {
    <style>
        /* --- AMAZON COLOR PALETTE --- */
        :root {
            --amazon-dark-text: #0F1111;
            --amazon-yellow-action: #FFD814;
            --amazon-yellow-action-hover: #F7CA00;
            --amazon-link-teal: #007185;
            --amazon-page-bg: #f7f7f7;
            --amazon-border-color: #D5DBDB;
            --amazon-warning-orange: #FEBD69;
        }

        .amazon-page-container {
            background-color: var(--amazon-page-bg);
            min-height: 100vh;
        }

        .text-amazon-dark {
            color: var(--amazon-dark-text);
        }

        .text-amazon-link {
            color: var(--amazon-link-teal) !important;
        }

        .amazon-form-box {
            border: 1px solid var(--amazon-border-color);
            border-radius: 8px;
            box-shadow: 0 1px 2px rgba(15, 17, 17, 0.15);
            background-color: white;
        }

        .amazon-header-section {
            background-color: #FAFAFA;
            border-bottom: 1px solid var(--amazon-border-color);
        }

        .btn-amazon-checkout {
            background-color: var(--amazon-yellow-action);
            border-color: #FCD200;
            color: var(--amazon-dark-text);
            font-weight: 700;
            box-shadow: 0 2px 5px 0 rgba(213, 217, 217, .5);
            border-radius: 7px;
            height: 35px;
            line-height: 1.2;
            font-size: 13px;
            padding: 0.375rem 1rem;
            width: 100%;
        }

            .btn-amazon-checkout:hover {
                background-color: var(--amazon-yellow-action-hover);
            }

        .form-section-header-amazon {
            color: var(--amazon-dark-text);
            font-weight: 700;
            margin-top: 2.5rem;
            margin-bottom: 1rem;
            padding-bottom: 5px;
            border-bottom: 1px solid #ddd;
            font-size: 1.25rem;
        }

        .danger-zone-card-amazon {
            border: 1px solid #dc3545;
            border-radius: 8px;
            background-color: #fff9fa;
        }

        .form-control:focus {
            border-color: var(--amazon-link-teal);
            box-shadow: 0 0 0 0.25rem rgba(0, 113, 133, 0.25);
        }

        .address-card {
            background-color: #fcfcfc;
            border: 1px solid #e7e7e7;
            border-radius: 8px;
            padding: 1.25rem;
            height: 100%;
        }
    </style>
}

<div class="amazon-page-container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-10 col-xl-8">

            <div class="text-center mb-4">
                <h1 class="display-5 fw-bold text-amazon-dark">Update Your Profile 🛠️</h1>
                <p class="text-muted">Manage your account, store, and payment details securely.</p>
            </div>

            <div class="amazon-form-box">
                <div class="p-4 text-center amazon-header-section rounded-top">
                    @* --- HEADER IMAGE LOGIC --- *@
                    @if (Model.IsImageApproved == true && !string.IsNullOrEmpty(Model.ExistingProfileImagePath))
                    {
                        <img src="/@Model.ExistingProfileImagePath" alt="Profile Image" class="img-fluid rounded-circle border border-2 border-light-subtle mb-3" style="width: 100px; height: 100px; object-fit: cover;" />
                    }
                    else if (Model.IsImagePending == true && !string.IsNullOrEmpty(Model.PendingProfileImagePath))
                    {
                        <div class="position-relative d-inline-block">
                            <img src="/@Model.PendingProfileImagePath" alt="Pending Profile Image" class="img-fluid rounded-circle border border-3 border-warning mb-3" style="width: 100px; height: 100px; object-fit: cover; opacity: 0.7;" />
                            <i class="fas fa-hourglass-half text-warning position-absolute top-0 end-0 bg-white rounded-circle p-1" style="font-size: 1.5rem; transform: translate(10%, -10%);"></i>
                        </div>
                    }
                    else
                    {
                        <i class="fas fa-user-circle fa-4x text-muted mb-3"></i>
                    }
                    <h2 class="h4 fw-bold text-amazon-dark mb-0">@Model.UserName</h2>
                    <p class="text-muted small">@Model.Profession</p>
                </div>

                <div class="card-body px-4 px-md-5 py-4">
                    <form asp-action="Profile" method="post" enctype="multipart/form-data">
                        <div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>
                        <input type="hidden" asp-for="UserId" />

                        @* --- HIDDEN FIELDS FOR PERSISTING STATE --- *@
                        <input type="hidden" asp-for="ExistingProfileImagePath" />
                        <input type="hidden" asp-for="ExistingGpayQRCodePath" />
                        <input type="hidden" asp-for="ExistingPhonePeQRCodePath" />
                        <input type="hidden" asp-for="IsImageApproved" />
                        <input type="hidden" asp-for="IsImagePending" />
                        <input type="hidden" asp-for="PendingProfileImagePath" />

                        <div class="form-check form-switch pt-2">
                            <input class="form-check-input" type="checkbox" role="switch" asp-for="IsProfileVisible" id="IsProfileVisibleSwitch" />
                            <label class="form-check-label" for="IsProfileVisibleSwitch">
                                <i class="fas fa-eye me-1"></i> Keep Profile Publicly Visible on <strong>Business Directory</strong>
                            </label>
                            <p class="text-muted small mt-1 mb-0">Uncheck this to hide your profile from public view.</p>
                        </div>

                        @* --- SECTION 1: ACCOUNT DETAILS --- *@
                        <h4 class="form-section-header-amazon"><i class="fas fa-user-circle me-2 text-amazon-link"></i> Account Details</h4>
                        <div class="row g-3 mb-4">
                            <div class="col-md-4 text-center">
                                @if (Model.IsImagePending == true && !string.IsNullOrEmpty(Model.PendingProfileImagePath))
                                {
                                    <div class="alert alert-warning p-2 small mb-2">
                                        <i class="fas fa-clock me-1"></i> Image pending approval.
                                    </div>
                                    <img src="/@Model.PendingProfileImagePath" alt="Pending" class="img-fluid rounded-circle mb-3 border border-3 border-warning" style="width: 100px; height: 100px; object-fit: cover;" />
                                }
                                else if (Model.IsImageApproved == true && !string.IsNullOrEmpty(Model.ExistingProfileImagePath))
                                {
                                    <img src="/@Model.ExistingProfileImagePath" alt="Profile" class="img-fluid rounded-circle mb-3 border border-1" style="width: 100px; height: 100px; object-fit: cover;" />
                                }
                                else
                                {
                                    <div class="rounded-circle bg-light d-inline-flex align-items-center justify-content-center mb-3 border border-1" style="width: 100px; height: 100px;">
                                        <i class="fas fa-camera fa-2x text-muted"></i>
                                    </div>
                                }
                                <label class="form-label small text-muted">Profile Photo</label>
                                <input type="file" asp-for="ProfileImageUpload" class="form-control form-control-sm" />
                                <span asp-validation-for="ProfileImageUpload" class="text-danger small"></span>
                            </div>

                            <div class="col-md-8">
                                <div class="form-floating mb-3">
                                    <input asp-for="UserName" class="form-control" placeholder="Username" />
                                    <label asp-for="UserName"></label>
                                    <span asp-validation-for="UserName" class="text-danger small"></span>
                                </div>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="form-floating mb-3">
                                            <input asp-for="FirstName" class="form-control" placeholder="First Name" />
                                            <label asp-for="FirstName"></label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-floating mb-3">
                                            <input asp-for="LastName" class="form-control" placeholder="Last Name" />
                                            <label asp-for="LastName"></label>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-floating mb-3">
                                    <input type="email" asp-for="Email" class="form-control" placeholder="Email" />
                                    <label asp-for="Email"></label>
                                </div>
                                <div class="form-floating mb-3">
                                    <input asp-for="PhoneNumber" class="form-control" placeholder="Mobile" />
                                    <label asp-for="PhoneNumber"></label>
                                </div>
                            </div>
                        </div>

                        @* --- SECTION 2: PROFESSIONAL --- *@
                        <h4 class="form-section-header-amazon"><i class="fas fa-briefcase me-2 text-amazon-link"></i> Professional</h4>
                        <div class="row g-3 mb-4">
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input asp-for="ITSNumber" class="form-control" placeholder="ITS Number" />
                                    <label asp-for="ITSNumber"></label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input asp-for="Profession" class="form-control" placeholder="Profession" />
                                    <label asp-for="Profession"></label>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="form-floating mb-3">
                                    <textarea asp-for="About" class="form-control" placeholder="About Me" style="height: 100px"></textarea>
                                    <label asp-for="About"></label>
                                </div>
                            </div>
                        </div>

                        @* --- SECTION 3: STORE & BUSINESS (NEW) --- *@
                        <h4 class="form-section-header-amazon"><i class="fas fa-store me-2 text-amazon-link"></i> Store & Business Details</h4>
                        <div class="row g-3 mb-4">
                            <div class="col-md-8">
                                <div class="form-floating mb-3">
                                    <input asp-for="StoreName" class="form-control" placeholder="Business Name" />
                                    <label asp-for="StoreName">Business / Store Name</label>
                                    <span asp-validation-for="StoreName" class="text-danger small"></span>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-floating mb-3">
                                    <input asp-for="GSTIN" class="form-control" placeholder="GSTIN" />
                                    <label asp-for="GSTIN">GSTIN (Optional)</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input type="email" asp-for="StoreEmail" class="form-control" placeholder="Store Email" />
                                    <label asp-for="StoreEmail">Business Email</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input asp-for="StoreContact" class="form-control" placeholder="Store Contact" />
                                    <label asp-for="StoreContact">Business Contact Number</label>
                                </div>
                            </div>
                        </div>

                        @* --- SECTION 4: ADDRESSES --- *@
                        <h4 class="form-section-header-amazon"><i class="fas fa-map-marker-alt me-2 text-amazon-link"></i> Addresses</h4>
                        <div class="row g-3 mb-4">
                            <div class="col-md-6">
                                <div class="address-card">
                                    <label class="form-label fw-bold small text-muted mb-3"><i class="fas fa-home me-1"></i> Home Address</label>
                                    <div class="form-floating mb-3">
                                        <input asp-for="HomeAddress" class="form-control" placeholder="Address" />
                                        <label asp-for="HomeAddress">Full Home Address</label>
                                    </div>
                                    <div class="form-floating">
                                        <input asp-for="HomePhoneNumber" class="form-control" placeholder="Phone" />
                                        <label asp-for="HomePhoneNumber">Landline/Home Phone</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="address-card">
                                    <label class="form-label fw-bold small text-muted mb-3"><i class="fas fa-building me-1"></i> Store/Business Address</label>
                                    <div class="form-floating mb-2">
                                        <input asp-for="StoreStreetAddress" class="form-control" placeholder="Street" />
                                        <label asp-for="StoreStreetAddress">Street Address</label>
                                    </div>
                                    <div class="row g-2">
                                        <div class="col-7">
                                            <div class="form-floating mb-2">
                                                <input asp-for="StoreCity" class="form-control" placeholder="City" />
                                                <label asp-for="StoreCity">City</label>
                                            </div>
                                        </div>
                                        <div class="col-5">
                                            <div class="form-floating mb-2">
                                                <input asp-for="StorePostCode" class="form-control" placeholder="PostCode" />
                                                <label asp-for="StorePostCode">Post Code</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-floating">
                                        <input asp-for="StoreCountry" class="form-control" placeholder="Country" />
                                        <label asp-for="StoreCountry">Country</label>
                                    </div>
                                    @* Keep hidden for legacy compatibility if backend expects BusinessAddress string *@
                                    <input type="hidden" asp-for="BusinessAddress" />
                                </div>
                            </div>
                        </div>

                        @* --- SECTION 5: PAYMENTS & SOCIAL --- *@
                        <h4 class="form-section-header-amazon"><i class="fas fa-qrcode me-2 text-amazon-link"></i> Payment & Social</h4>
                        <div class="row g-4 mb-4">
                            <div class="col-md-6 text-center">
                                <label class="form-label small text-muted">GPay QR Code</label>
                                @if (!string.IsNullOrEmpty(Model.ExistingGpayQRCodePath))
                                {
                                    <img src="/@Model.ExistingGpayQRCodePath" alt="GPay" class="img-fluid border rounded d-block mx-auto mb-2" style="max-height: 120px;" />
                                }
                                <input type="file" asp-for="GpayQRCodeUpload" class="form-control form-control-sm" />
                            </div>
                            <div class="col-md-6 text-center">
                                <label class="form-label small text-muted">PhonePe QR Code</label>
                                @if (!string.IsNullOrEmpty(Model.ExistingPhonePeQRCodePath))
                                {
                                    <img src="/@Model.ExistingPhonePeQRCodePath" alt="PhonePe" class="img-fluid border rounded d-block mx-auto mb-2" style="max-height: 120px;" />
                                }
                                <input type="file" asp-for="PhonePeQRCodeUpload" class="form-control form-control-sm" />
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating">
                                    <input asp-for="WhatsappNumber" class="form-control" placeholder="WhatsApp" />
                                    <label asp-for="WhatsappNumber">WhatsApp Number</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating">
                                    <input asp-for="LinkedInUrl" class="form-control" placeholder="LinkedIn" />
                                    <label asp-for="LinkedInUrl">LinkedIn Profile URL</label>
                                </div>
                            </div>
                        </div>

                        <div class="d-grid mt-5">
                            <button type="submit" class="btn btn-amazon-checkout fw-bold py-2">
                                <i class="fas fa-save me-2"></i> Save Changes & Update Directory
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            @* --- DANGER ZONE --- *@
            <div class="card danger-zone-card-amazon mt-5">
                <div class="card-body p-4 text-center">
                    <h5 class="text-danger mb-3 fw-bold small"><i class="fas fa-exclamation-triangle me-2"></i> Danger Zone</h5>
                    <p class="text-muted small">This will wipe your directory profile but keep your login active.</p>
                    <form asp-action="DeleteProfileData" method="post" onsubmit="return confirm('Erase all profile data?');">
                        <button type="submit" class="btn btn-outline-danger btn-sm">
                            Delete Profile Information
                        </button>
                    </form>
                </div>
            </div>

        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}