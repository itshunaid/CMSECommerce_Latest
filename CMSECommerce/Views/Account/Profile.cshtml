@model CMSECommerce.Models.ViewModels.ProfileUpdateViewModel

@{
    ViewData["Title"] = "Update Profile";
}

@section Styles {
    <style>
        /* --- AMAZON COLOR PALETTE --- */
        :root {
            --amazon-dark-text: #0F1111;
            --amazon-yellow-action: #FFD814;
            --amazon-yellow-action-hover: #F7CA00;
            --amazon-link-teal: #007185;
            --amazon-page-bg: #f7f7f7; /* Light grey background */
            --amazon-border-color: #D5DBDB;
            --amazon-warning-orange: #FEBD69; /* For pending state */
        }

        .amazon-page-container {
            background-color: var(--amazon-page-bg);
            min-height: 100vh;
        }

        .text-amazon-dark {
            color: var(--amazon-dark-text);
        }

        .text-amazon-link {
            color: var(--amazon-link-teal) !important;
        }

        /* Central Form Box/Card Styling - Clean White with subtle border/shadow */
        .amazon-form-box {
            border: 1px solid var(--amazon-border-color);
            border-radius: 8px;
            box-shadow: 0 1px 2px rgba(15, 17, 17, 0.15);
            background-color: white; /* Important: ensures card is white */
        }

        /* Header Section - Light background, not a heavy gradient */
        .amazon-header-section {
            background-color: #FAFAFA; /* Very light header */
            border-bottom: 1px solid var(--amazon-border-color);
        }

        /* Primary Action Button (Save Changes) - Amazon Yellow/Orange */
        .btn-amazon-checkout {
            background-color: var(--amazon-yellow-action);
            border-color: #FCD200;
            color: var(--amazon-dark-text);
            font-weight: 700;
            /* Subtler shadow for the button */
            box-shadow: 0 2px 5px 0 rgba(213, 217, 217, .5);
            border-radius: 7px;
            height: 35px;
            line-height: 1.2;
            font-size: 13px;
            padding: 0.375rem 1rem;
            width: 100%;
        }

            .btn-amazon-checkout:hover {
                background-color: var(--amazon-yellow-action-hover);
            }

        /* Form Headers */
        .form-section-header-amazon {
            color: var(--amazon-dark-text);
            font-weight: 700;
            margin-top: 2.5rem;
            margin-bottom: 1rem;
            padding-bottom: 5px;
            border-bottom: 1px solid #ddd;
            font-size: 1.25rem;
        }

        /* Danger Zone Card */
        .danger-zone-card-amazon {
            border: 1px solid #dc3545;
            border-radius: 8px;
            background-color: #fff9fa;
        }

            .danger-zone-card-amazon .card-body p {
                font-size: 0.875rem;
            }

        /* Input Field Styling - Focus border changes to Amazon teal */
        .form-control:focus {
            border-color: var(--amazon-link-teal);
            box-shadow: 0 0 0 0.25rem rgba(0, 113, 133, 0.25);
        }
    </style>
}

<div class="amazon-page-container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-10 col-xl-8">

            <div class="text-center mb-4">
                <h1 class="display-5 fw-bold text-amazon-dark">Update Your Profile 🛠️</h1>
                <p class="text-muted">Manage your account, contact, and payment details securely.</p>
            </div>

            <div class="amazon-form-box">
                <div class="p-4 text-center amazon-header-section rounded-top">
                    @* --- HEADER IMAGE LOGIC START (Shows approved image or placeholder) --- *@
                    @if (Model.IsImageApproved == true && !string.IsNullOrEmpty(Model.ExistingProfileImagePath))
                    {
                        <img src="/@Model.ExistingProfileImagePath" alt="Profile Image" class="img-fluid rounded-circle border border-2 border-light-subtle mb-3" style="width: 100px; height: 100px; object-fit: cover;" />
                    }
                    else if (Model.IsImagePending == true && !string.IsNullOrEmpty(Model.PendingProfileImagePath))
                    {
                        @* Show the pending image, perhaps with a slight visual indication *@
                        <div class="position-relative d-inline-block">
                            <img src="/@Model.PendingProfileImagePath" alt="Pending Profile Image" class="img-fluid rounded-circle border border-3 border-warning mb-3" style="width: 100px; height: 100px; object-fit: cover; opacity: 0.7;" />
                            <i class="fas fa-hourglass-half text-warning position-absolute top-0 end-0 bg-white rounded-circle p-1" style="font-size: 1.5rem; transform: translate(10%, -10%);"></i>
                        </div>
                    }
                    else
                    {
                        <i class="fas fa-user-circle fa-4x text-muted mb-3"></i>
                    }
                    @* --- HEADER IMAGE LOGIC END --- *@
                    <h2 class="h4 fw-bold text-amazon-dark mb-0">@Model.UserName</h2>
                    <p class="text-muted small">@Model.Profession</p>
                </div>

                <div class="card-body px-4 px-md-5 py-4">
                    <form asp-action="Profile" method="post" enctype="multipart/form-data">
                        <div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>
                        <input type="hidden" asp-for="UserId" />

                        @* --- HIDDEN FIELDS FOR PERSISTING STATE --- *@
                        <input type="hidden" asp-for="ExistingProfileImagePath" />
                        <input type="hidden" asp-for="ExistingGpayQRCodePath" />
                        <input type="hidden" asp-for="ExistingPhonePeQRCodePath" />
                        <input type="hidden" asp-for="IsImageApproved" />
                        <input type="hidden" asp-for="IsImagePending" />
                        <input type="hidden" asp-for="PendingProfileImagePath" />
                        @* --- END HIDDEN FIELDS --- *@


                        <div class="form-check form-switch pt-2">
                            <input class="form-check-input" type="checkbox" role="switch" asp-for="IsProfileVisible" id="IsProfileVisibleSwitch" />
                            <label class="form-check-label" for="IsProfileVisibleSwitch">
                                <i class="fas fa-eye me-1"></i> Keep Profile Publicly Visible on <strong>Business Directory</strong>
                            </label>
                            <p class="text-muted small mt-1 mb-0">Uncheck this to hide your profile from public view across the site.</p>
                        </div>
                        <h4 class="form-section-header-amazon"><i class="fas fa-user-circle me-2 text-amazon-link"></i> Account Details</h4>

                        <div class="row g-3 mb-4">

                            <div class="col-md-4 text-center">
                                @* --- PROFILE IMAGE DISPLAY IN FORM START (With pending warning) --- *@
                                @if (Model.IsImagePending == true && !string.IsNullOrEmpty(Model.PendingProfileImagePath))
                                {
                                    <div class="alert alert-warning p-2 small mb-2">
                                        <i class="fas fa-clock me-1"></i> New image pending approval.
                                    </div>
                                    <img src="/@Model.PendingProfileImagePath" alt="Pending Profile Image" class="img-fluid rounded-circle mb-3 border border-3 border-warning" style="width: 100px; height: 100px; object-fit: cover;" />
                                }
                                else if (Model.IsImageApproved == true && !string.IsNullOrEmpty(Model.ExistingProfileImagePath))
                                {
                                    <img src="/@Model.ExistingProfileImagePath" alt="Profile Image" class="img-fluid rounded-circle mb-3 border border-1" style="width: 100px; height: 100px; object-fit: cover;" />
                                }
                                else
                                {
                                    <div class="rounded-circle bg-light d-inline-flex align-items-center justify-content-center mb-3 border border-1" style="width: 100px; height: 100px;">
                                        <i class="fas fa-camera fa-2x text-muted"></i>
                                    </div>
                                }
                                <label class="form-label small text-muted">Profile Photo</label>
                                <input type="file" asp-for="ProfileImageUpload" class="form-control form-control-sm" />
                                <span asp-validation-for="ProfileImageUpload" class="text-danger small"></span>
                                @* --- PROFILE IMAGE DISPLAY IN FORM END --- *@
                            </div>

                            <div class="col-md-8">
                                <div class="form-floating mb-3">
                                    <input asp-for="UserName" class="form-control" placeholder="Username" />
                                    <label asp-for="UserName"></label>
                                    <span asp-validation-for="UserName" class="text-danger small"></span>
                                </div>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="form-floating mb-3">
                                            <input asp-for="FirstName" class="form-control" placeholder="First Name" />
                                            <label asp-for="FirstName"></label>
                                            <span asp-validation-for="FirstName" class="text-danger small"></span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-floating mb-3">
                                            <input asp-for="LastName" class="form-control" placeholder="Last Name" />
                                            <label asp-for="LastName"></label>
                                            <span asp-validation-for="LastName" class="text-danger small"></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-floating mb-3">
                                    <input type="email" asp-for="Email" class="form-control" placeholder="Email" />
                                    <label asp-for="Email"></label>
                                    <span asp-validation-for="Email" class="text-danger small"></span>
                                </div>
                                <div class="form-floating mb-3">
                                    <input asp-for="PhoneNumber" class="form-control" placeholder="Mobile Number" />
                                    <label asp-for="PhoneNumber"></label>
                                    <span asp-validation-for="PhoneNumber" class="text-danger small"></span>
                                </div>


                            </div>
                        </div>

                        <h4 class="form-section-header-amazon"><i class="fas fa-briefcase me-2 text-amazon-link"></i> Professional & Contact</h4>
                        <div class="row g-3 mb-4">
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input asp-for="ITSNumber" class="form-control" placeholder="ITS Number" />
                                    <label asp-for="ITSNumber"></label>
                                    <span asp-validation-for="ITSNumber" class="text-danger small"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input asp-for="Profession" class="form-control" placeholder="Profession" />
                                    <label asp-for="Profession"></label>
                                    <span asp-validation-for="Profession" class="text-danger small"></span>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="form-floating mb-3">
                                    <textarea asp-for="About" class="form-control" placeholder="About Me" style="height: 100px"></textarea>
                                    <label asp-for="About"></label>
                                    <span asp-validation-for="About" class="text-danger small"></span>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="form-floating mb-3">
                                    <input asp-for="ServicesProvided" class="form-control" placeholder="Services Provided (Comma Separated)" />
                                    <label asp-for="ServicesProvided"></label>
                                    <span asp-validation-for="ServicesProvided" class="text-danger small"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input asp-for="WhatsappNumber" class="form-control" placeholder="WhatsApp Number" />
                                    <label asp-for="WhatsappNumber"></label>
                                    <span asp-validation-for="WhatsappNumber" class="text-danger small"></span>
                                </div>
                            </div>
                        </div>

                        <h4 class="form-section-header-amazon"><i class="fas fa-share-alt me-2 text-amazon-link"></i> Social Media Links</h4>
                        <div class="row g-3 mb-4">
                            <div class="col-md-4">
                                <div class="form-floating mb-3">
                                    <input asp-for="LinkedInUrl" class="form-control" placeholder="LinkedIn URL" />
                                    <label asp-for="LinkedInUrl"></label>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-floating mb-3">
                                    <input asp-for="FacebookUrl" class="form-control" placeholder="Facebook URL" />
                                    <label asp-for="FacebookUrl"></label>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-floating mb-3">
                                    <input asp-for="InstagramUrl" class="form-control" placeholder="Instagram URL" />
                                    <label asp-for="InstagramUrl"></label>
                                </div>
                            </div>
                        </div>

                        <h4 class="form-section-header-amazon"><i class="fas fa-map-marker-alt me-2 text-amazon-link"></i> Addresses</h4>
                        <div class="row g-3 mb-4">
                            <div class="col-md-6">
                                <label class="form-label fw-bold small text-muted mb-2">Home Address</label>
                                <div class="form-floating mb-3">
                                    <input asp-for="HomeAddress" class="form-control" placeholder="Home Address" />
                                    <label asp-for="HomeAddress"></label>
                                </div>
                                <div class="form-floating">
                                    <input asp-for="HomePhoneNumber" class="form-control" placeholder="Home Phone Number" />
                                    <label asp-for="HomePhoneNumber"></label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-bold small text-muted mb-2">Business Address</label>
                                <div class="form-floating mb-3">
                                    <input asp-for="BusinessAddress" class="form-control" placeholder="Business Address" />
                                    <label asp-for="BusinessAddress"></label>
                                </div>
                                <div class="form-floating">
                                    <input asp-for="BusinessPhoneNumber" class="form-control" placeholder="Business Phone Number" />
                                    <label asp-for="BusinessPhoneNumber"></label>
                                </div>
                            </div>
                        </div>

                        <h4 class="form-section-header-amazon"><i class="fas fa-qrcode me-2 text-amazon-link"></i> Payment Details (QR Codes)</h4>
                        <div class="row g-4 mb-4">
                            <div class="col-md-6 text-center">
                                <label class="form-label small text-muted">GPay QR Code</label>
                                @if (!string.IsNullOrEmpty(Model.ExistingGpayQRCodePath))
                                {
                                    <img src="/@Model.ExistingGpayQRCodePath" alt="GPay QR" class="img-fluid border rounded mb-2" style="max-height: 150px; max-width: 150px;" />
                                }
                                <input type="file" asp-for="GpayQRCodeUpload" class="form-control form-control-sm" />
                                <span asp-validation-for="GpayQRCodeUpload" class="text-danger small"></span>
                            </div>
                            <div class="col-md-6 text-center">
                                <label class="form-label small text-muted">PhonePe QR Code</label>
                                @if (!string.IsNullOrEmpty(Model.ExistingPhonePeQRCodePath))
                                {
                                    <img src="/@Model.ExistingPhonePeQRCodePath" alt="PhonePe QR" class="img-fluid border rounded mb-2" style="max-height: 150px; max-width: 150px;" />
                                }
                                <input type="file" asp-for="PhonePeQRCodeUpload" class="form-control form-control-sm" />
                                <span asp-validation-for="PhonePeQRCodeUpload" class="text-danger small"></span>
                            </div>
                        </div>

                        <div class="d-grid mt-4">
                            <button type="submit" class="btn btn-amazon-checkout fw-bold">
                                <i class="fas fa-save me-2"></i> Save Changes
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <hr class="my-5 border-amazon-border-color" />

            <div class="card danger-zone-card-amazon">
                <div class="card-body p-4">
                    <h5 class="text-danger mb-3 fw-bold small"><i class="fas fa-exclamation-triangle me-2"></i> Danger Zone</h5>
                    <p class="text-muted small">
                        Permanently delete all custom profile data (ITS number, addresses, social links, images, QR codes, etc.) without deleting your main login credentials.
                    </p>
                    <form asp-action="DeleteProfileData" method="post" onsubmit="return confirm('WARNING: Are you sure you want to delete all your custom profile data? This action is irreversible.');">
                        <button type="submit" class="btn btn-danger btn-sm">
                            <i class="fas fa-trash me-1"></i> Delete Profile Data Only
                        </button>
                    </form>
                </div>
            </div>

        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}