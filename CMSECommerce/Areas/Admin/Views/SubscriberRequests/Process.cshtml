@model CMSECommerce.Models.SubscriberRequest

@{
    ViewData["Title"] = $"Review Request: {Model.UserName}";
}

<h2 class="mt-4">Review Subscriber Request</h2>
<hr />

<dl class="row">
    <dt class="col-sm-3">User Name</dt>
    <dd class="col-sm-9">@Model.UserName</dd>

    <dt class="col-sm-3">User ID</dt>
    <dd class="col-sm-9">@Model.UserId</dd>

    <dt class="col-sm-3">Date Submitted</dt>
    <dd class="col-sm-9">@Model.RequestDate.ToString("MMMM dd, yyyy h:mm tt")</dd>

    <dt class="col-sm-3">Requested Role</dt>
    <dd class="col-sm-9">@Model.RequestedRole</dd>

    <dt class="col-sm-3">Current Status</dt>
    <dd class="col-sm-9">
        @{
            // Determine display based on the nullable Approved property (bool?)
            string statusClass = Model.Approved == null ? "badge bg-primary" :
            Model.Approved == true ? "badge bg-success" : "badge bg-danger";
            string statusText = Model.Approved == null ? "Pending" :
            Model.Approved == true ? "Approved" : "Rejected";
        }
        <span class="@statusClass font-weight-bold">@statusText</span>

        @* Display the processing date if the request has been processed *@
        @if (Model.ApprovalDate.HasValue)
        {
            <small class="text-muted">(Processed on @Model.ApprovalDate.Value.ToShortDateString())</small>
        }
    </dd>

    @if (!string.IsNullOrEmpty(Model.AdminNotes))
    {
        <dt class="col-sm-3">Admin Notes</dt>
        <dd class="col-sm-9 text-muted">@Model.AdminNotes</dd>
    }
</dl>

@* -----------------------------------------------------------------
   --- Processing Form: Targets the POST Process Action ---
   ----------------------------------------------------------------- *@
@if (Model.Approved == false)
{
    <h4 class="mt-5">Process Request</h4>
    <div class="card p-4">
        
        <form asp-action="Process" method="post">
            <input type="hidden" name="id" value="@Model.Id" />

            <div class="form-group mb-4">
                <label for="adminNotes">Notes for User (Optional):</label>
                <textarea name="adminNotes" class="form-control" rows="3" placeholder="Enter notes visible to the user (e.g., reason for rejection or approval confirmation)."></textarea>
                <small class="form-text text-muted">Notes entered here will be visible on the user's Request Status page.</small>
            </div>

            <div class="d-flex justify-content-between">
                <button type="submit" name="adminAction" value="Reject" class="btn btn-lg btn-danger">
                    <i class="fas fa-times-circle"></i> Reject Request
                </button>

                <button type="submit" name="adminAction" value="Approve" class="btn btn-lg btn-success">
                    <i class="fas fa-check-circle"></i> Approve Request & Grant Role
                </button>
            </div>
            @Html.AntiForgeryToken()
        </form>
    </div>
}
else
{
    <div class="alert alert-secondary mt-5">
        This request has already been processed. See the status above.
    </div>
}

<div class="mt-4">
    <a asp-action="Index" class="btn btn-secondary">Back to List</a>
</div>